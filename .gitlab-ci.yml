stages:
  - validate
  - test

image: python:3.12

variables:
  DJANGO_SETTINGS_MODULE: "mptcourse.settings"
  VENV_PATH: ".venv"

before_script:
  - python3 -m venv .venv
  - source .venv/bin/activate
  - pip install --upgrade pip setuptools wheel
  - pip install -r requirements.txt

validate-django-settings:
  stage: validate
  script:
    - source .venv/bin/activate
    - python3 manage.py check

validate-migrations:
  stage: validate
  script:
    - source .venv/bin/activate
    - python3 manage.py makemigrations --check --dry-run

linter-check:
  stage: validate
  script:
    - source .venv/bin/activate
    - pip install flake8
    - flake8 main mptcourse --config=.flake8

test-staticfiles:
  stage: test
  script:
    - source .venv/bin/activate
    - python3 manage.py collectstatic --noinput --dry-run