stages:
  - validate
  - test

image: python:3.12

variables:
  DJANGO_SETTINGS_MODULE: "mptcourse.settings"
  VENV_PATH: ".venv"

before_script:
  - python3 -m venv "$VENV_PATH"
  - source "$VENV_PATH/bin/activate"
  - pip install -r requirements.txt

validate-django-settings:
  stage: validate
  script:
    - source "$VENV_PATH/bin/activate"
    - python manage.py check

validate-migrations:
  stage: validate
  script:
    - source "$VENV_PATH/bin/activate"
    - python manage.py makemigrations --check --dry-run

linter-check:
  stage: validate
  script:
    - source "$VENV_PATH/bin/activate"
    - pip install flake8
    - flake8 main mptcourse --config=.flake8 || true

test-staticfiles:
  stage: test
  script:
    - source "$VENV_PATH/bin/activate"
    - python manage.py collectstatic --noinput 
